<ng-container [ngSwitch]="currentViewState">

    <!--<lib-user-segment-add *ngSwitchCase="'ADD_SEGMENT'"
                          (cancel)="onUserSegmentCancel()"
                          (add)="onUserSegmentCreate($event)">
    </lib-user-segment-add>

    <lib-user-segment-list *ngSwitchCase="'SELECT_SEGMENT'"
                           (cancel)="onUserSegmentCancel()"
                           (add)="onUserSegmentAdd($event)"
                           [selectedUserSegments]="userSegments">
    </lib-user-segment-list>-->

    <div *ngSwitchCase="'ADD_CONVERSATION'" class="uci-add-container">
        <div class="ui grid">
            <div class="six wide column pr-0">
                <div class="d-flex font-0-75" style="align-items: baseline;">
                    <div style="width: 30px">
                        <button mat-mini-fab
                                class="circular-button"
                                style="font-size: 0.75rem"
                                (click)="backToStepOne()"
                                [ngClass]="{'blue-bg-white-text': stepIndex === 1, 'green-bg-white-text': stepIndex === 2}">
                            1
                        </button>
                    </div>
                    <div class="px-5 pt-10">{{resourceService.frmelmnts?.lbl?.conversationSetup}}</div>
                    <div class="line mt-20 ml-20 mr-20"></div>
                    <div style="width: 30px">
                        <button mat-mini-fab
                                class="circular-button"
                                style="font-size: 0.75rem"
                                [disabled]="!(stepIndex === 2)"
                                [ngClass]="{'blue-bg-white-text': stepIndex === 2}">
                            2
                        </button>
                    </div>
                    <div class="px-5 pt-10 font-weight-bold">{{resourceService.frmelmnts?.lbl?.conversationFlow}}</div>
                </div>
            </div>
            <div class="six wide column">
                <ng-container *ngIf="stepIndex === 1; else stp2_btn">
                    <div class="right-floated pt-0">
                        <button mat-raised-button class="mr-10" (click)="onAddCancel()">
                            {{resourceService.frmelmnts?.btn?.cancel}}
                        </button>
                        <button mat-raised-button class="uci-action-button"
                                [disabled]="conversationForm.invalid || isStartingMessageExist"
                                (click)="nextStep()"> {{resourceService.frmelmnts?.btn?.next}}
                        </button>
                    </div>
                </ng-container>
                <ng-template #stp2_btn>
                    <div class="ui grid">
                        <div class="twelve wide column">
                            <div class="right-floated pt-0">
                                <button mat-raised-button class="mr-10" *ngIf="!isLoaderShow"
                                        (click)="backToStepOne()"> {{resourceService.frmelmnts?.btn?.back}}
                                </button>
                                <button mat-raised-button class="mr-10 primary" *ngIf="!isLoaderShow"
                                        (click)="openItemsVerifyModal(false)"
                                        [disabled]="!isCheckedTermCondition || !botLogics.length">
                                    {{resourceService.frmelmnts?.btn?.save}}
                                </button>
                                <ng-container *ngIf="isLoaderShow; else submitBtn1">
                                    <button class="action-button p-0">
                                        <div class="ui active tiny inline loader"></div>
                                    </button>
                                </ng-container>
                                <ng-template #submitBtn1>
                                    <button mat-raised-button class="uci-action-button"
                                            [disabled]="!isCheckedTermCondition || !botLogics.length"
                                            (click)="this.conversationId ? onSubmit(true) : openItemsVerifyModal(true)">
                                        {{conversationId ? resourceService.frmelmnts?.btn?.update : resourceService.frmelmnts?.btn?.submit}}
                                    </button>
                                </ng-template>

                            </div>
                        </div>
                        <div class="twelve wide column pt-0">
                            <div class="right-floated pt-0">
                                <mat-checkbox name="isCheckedTermCondition"  [color]="'primary'"
                                              [(ngModel)]="isCheckedTermCondition">
                                    <mat-label class="font-weight-normal t-and-c-title">
                                        <a class="tc-tag" href="https://diksha.gov.in/term-of-use.html" target="_blank">
                                            {{resourceService.frmelmnts?.lbl?.aggreeTc}}
                                        </a>
                                    </mat-label>
                                </mat-checkbox>
                            </div>
                        </div>
                    </div>
                </ng-template>

            </div>
        </div>
        <div class="step1-wrapper" *ngIf="stepIndex === 1">
            <div class="ui grid">
                <div class="ten wide column font-1-2 font-weight-bold">
                    {{resourceService.frmelmnts?.lbl?.addConversation}}
                </div>
                <div class="ten wide column pt-0">
                    <form [formGroup]="conversationForm" class="ui form">
                        <div class="field">
                            <mat-label>{{resourceService.frmelmnts?.lbl?.conversationName}} <sup><i
                                    class="asterisk icon asterisk-color"></i></sup></mat-label>
                            <input matInput type="text" name="name" placeholder="{{resourceService.frmelmnts?.lbl?.enterName}}" formControlName="name">
                        </div>
                        <div class="field">
                            <mat-label>{{resourceService.frmelmnts?.lbl?.conversationDescription}}</mat-label>
                            <textarea rows="5" name="description" placeholder="{{resourceService.frmelmnts?.lbl?.enterDescription}}"
                                      formControlName="description"></textarea>
                        </div>
                        <div class="field">
                            <mat-label>{{resourceService.frmelmnts?.lbl?.conversationPurpose}} <sup><i
                                    class="asterisk icon asterisk-color"></i></sup></mat-label>
                            <input matInput type="text" name="name" placeholder="{{resourceService.frmelmnts?.lbl?.enterPurpose}}"
                                   formControlName="purpose">
                        </div>
                        <div class="field">
                            <mat-label>{{resourceService.frmelmnts?.lbl?.startMessage}} <sup><i
                                    class="asterisk icon asterisk-color"></i></sup></mat-label>
                            <input matInput type="text" name="startingMessage" placeholder="{{resourceService.frmelmnts?.lbl?.enterMessage}}"
                                   formControlName="startingMessage">
                            <small *ngIf="isStartingMessageExist" class="text-danger">
                                {{resourceService.frmelmnts?.lbl?.startMessageError}}
                            </small>
                        </div>
                        <div class="two fields">
                            <div class="field">
                                <!--<mat-form-field appearance="fill">
                                    <mat-label>{{resourceService.frmelmnts?.lbl?.startDate}}</mat-label>
                                    <input matInput [matDatepicker]="picker" formControlName="startDate">
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker #picker></mat-datepicker>
                                </mat-form-field>-->
                                <mat-label>{{resourceService.frmelmnts?.lbl?.startDate}}</mat-label>
                                <div class="ui left icon input">
                                    <i class="calendar icon"></i>
                                    <input suiDatepicker
                                           formControlName="startDate"
                                           [pickerMode]="'date'"
                                           [pickerMinDate]="startMinDate"
                                           [pickerUseNativeOnMobile]="false">
                                </div>
                            </div>
                            <div class="field">
                                <mat-label>{{resourceService.frmelmnts?.lbl?.endDate}}</mat-label>
                                <div class="ui left icon input">
                                    <i class="calendar icon"></i>
                                    <input suiDatepicker
                                           formControlName="endDate"
                                           [pickerMode]="'date'"
                                           [pickerMinDate]="endMinDate"
                                           [pickerUseNativeOnMobile]="false">
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
            <!--Will enable this in future-->
            <!--<div class="ui divider"></div>
            <div class="ui grid">
                <div class="six wide column">
                    <h6>User segments</h6>
                    <p class="pt-10">{{userSegments.length}} segments added</p>
                </div>
                <div class="six wide column  right aligned">
                    <div class="pt-0">
                        <button mat-mini-fab class="action-button mr-10"
                                (click)="onUserSegmentAddClick()">
                            Create new
                        </button>
                        <button mat-mini-fab class="action-button" (click)="userSegment()">
                            Choose from existing
                        </button>
                    </div>
                </div>
            </div>-->
            <div class="ui grid">
                <ng-container *ngIf="userSegments && userSegments.length">
                    <div class="ui three column grid">
                        <div class="column" *ngFor="let userSegment of userSegments; let i = index">
                            <div class="ui fluid card">
                                <div class="content">
                                    <i class="right floated icon trash delete-icon"
                                       (click)="onUserSegmentDelete(i)"></i>
                                    {{userSegment.name}}
                                    <div class="meta">{{resourceService.frmelmnts?.lbl?.userCount}} {{userSegment.count}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>

            </div>
        </div>

        <div class="step2-wrapper" *ngIf="stepIndex === 2">
            <lib-logic-list [botLogics]="botLogics" (modify)="onBotLogicModify($event)"></lib-logic-list>
        </div>
    </div>
</ng-container>

<!--<mat-dialog-content *ngIf="collectionListModal"
           class="sb-modal" (dismissed)="this.collectionListModal = false;" #modal>
    <div class="sb-modal-header">
        {{logicForm.get('id').value ? ' Update' : 'Add'}} Conversation Logic
    </div>
    <div class="sb-modal-content">
        <form [formGroup]="logicForm" class="ui form">
            <div class="field">
                <mat-label>Name <sup><i class="asterisk icon asterisk-color"></i></sup></mat-label>
                <input matInput type="text" name="name" placeholder="Enter name" formControlName="name">
            </div>
            <div class="field">
                <mat-label>Description</mat-label>
                <textarea rows="3" name="description" placeholder="Enter description"
                          formControlName="description"></textarea>
            </div>
            <div class="field">
                <mat-label>
                    <div class="two fields m-0">
                        <div class="field p-0">
                            Upload ODK Form (.xml)<sup><i class="asterisk icon asterisk-color"></i></sup>
                        </div>
                        <div class="field text-right p-0">
                            <a class="mx-20 sample-download" (click)="manualDownload()">Instruction Manual</a>
                            <a class="ml-1 sample-download" (click)="sampleODKDownload()">Sample ODK Form (.xlsx)</a>
                        </div>
                    </div>

                </mat-label>
                <input type="file" name="file" placeholder="Browse XML File..."
                       (change)="onFileUpload($event)" accept=".xml">
                <small *ngIf="odkFileAlreadyExist" class="text-danger">{{fileErrorStatus}}</small>
            </div>
        </form>
    </div>
    <div class="sb-modal-actions">
        <ng-container *ngIf="isModalLoaderShow; else modalBtn">
            <button mat-raised-button class="action-button p-0">
                <div class="ui active tiny inline loader"></div>
            </button>
        </ng-container>
        <ng-template #modalBtn>
            <button mat-raised-button class="action-button" (click)="onLogicAdd();modal.deny('denied')"
                    [disabled]="logicForm.invalid">
                {{logicForm.get('id').value ? ' Update' : 'Add'}}
            </button>
        </ng-template>
        <button mat-raised-button class="action-button"
                (click)="modal.deny('denied');isModalLoaderShow = false;logicForm.patchValue({formId: ''});">
            Cancel
        </button>
    </div>
</mat-dialog-content>-->

<!--<sui-modal *ngIf="termsAndConditionModal" [mustScroll]="true" [isClosable]="false" [transitionDuration]="0"
           [size]="'large'"
           class="sb-modal" (dismissed)="this.termsAndConditionModal = false" #modal>
    <div class="sb-modal-header">
        {{resourceService.frmelmnts?.lbl?.termsConditions}}
    </div>
    <div class="sb-modal-content">
        <lib-terms-conditions></lib-terms-conditions>
    </div>
    <div class="sb-modal-actions">
        <button mat-raised-button class="action-button"
                (click)="modal.deny('denied');">
            {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
    </div>
</sui-modal>-->

<!--<sui-modal *ngIf="verifyAllItemsModal" [mustScroll]="true" [isClosable]="false" [transitionDuration]="0"
           [size]="'large'"
           class="sb-modal" (dismissed)="this.verifyAllItemsModal = false" #verifyAllModal>
    <div class="sb-modal-header">
        <h4>
            {{resourceService.frmelmnts?.lbl?.confirmWarning}}:
        </h4>
    </div>
    <div class="sb-modal-content">
        <div class="ui grid">
            <div class="four wide column">
                <div class="mb-20">
                    <h4>Appropriateness</h4>
                    <div class="ui divider"></div>
                </div>
                <div class="ui grid" *ngFor="let list of Appropriateness; let i = index">
                    <div class="two wide column pb-0">
                        <mat-checkbox [name]="'appropriateness' + i" [(ngModel)]="list.checks" (ngModelChange)="updateAllChecked()">
                        </mat-checkbox>
                    </div>
                    <div class="ten wide column pl-0 pb-0 line-height">
                        {{list.text}}
                    </div>
                </div>
            </div>
            <div class="four wide column">
                <div class="mb-20">
                    <h4>Content Details</h4>
                    <div class="ui divider"></div>
                </div>
                <div class="ui grid" *ngFor="let list of contentDetails; let i = index">
                    <div class="two wide column pb-0">
                        <mat-checkbox [name]="'contentDetails' + i" [(ngModel)]="list.checks" (ngModelChange)="updateAllChecked()">
                        </mat-checkbox>
                    </div>
                    <div class="ten wide column pl-0 pb-0 line-height">
                        {{list.text}}
                    </div>
                </div>
            </div>
            <div class="four wide column">
                <div class="mb-20">
                    <h4>Usability</h4>
                    <div class="ui divider"></div>
                </div>
                <div class="ui grid" *ngFor="let list of usability; let i = index">
                    <div class="two wide column pb-0">
                        <mat-checkbox [name]="'usability' + i" [(ngModel)]="list.checks" (ngModelChange)="updateAllChecked()">
                        </mat-checkbox>
                    </div>
                    <div class="ten wide column pl-0 pb-0 line-height">
                        {{list.text}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sb-modal-actions">
        <ng-container *ngIf="isLoaderShow; else submitBtn">
            <button mat-raised-button class="action-button p-0">
                <div class="ui active tiny inline loader"></div>
            </button>
        </ng-container>
        <ng-template #submitBtn>
            <button mat-raised-button *ngIf="isSubmit" class="action-button"
                    [disabled]="!this.allChecked"
                    (click)="onSubmit(true);">
                {{resourceService.frmelmnts?.btn?.submit}}
            </button>
            <button mat-raised-button *ngIf="!isSubmit" class="action-button"
                    [disabled]="!this.allChecked"
                    (click)="onSubmit(false);">
                {{resourceService.frmelmnts?.btn?.save}}
            </button>
        </ng-template>
        <button mat-raised-button class="action-button"
                (click)="allCheck(false); verifyAllModal.deny('denied');">
            {{resourceService.frmelmnts?.btn?.cancel}}
        </button>
        <button mat-raised-button class="action-button allCheckBtn" (click)="allCheck(true)">
            {{resourceService.frmelmnts?.btn?.confirmAll}}
        </button>
    </div>
</sui-modal>-->
